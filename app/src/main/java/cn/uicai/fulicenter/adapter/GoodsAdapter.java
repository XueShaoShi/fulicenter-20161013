package cn.uicai.fulicenter.adapter;import android.content.Context;import android.content.Intent;import android.support.v7.widget.RecyclerView.Adapter;import android.support.v7.widget.RecyclerView.ViewHolder;import android.view.View;import android.view.ViewGroup;import android.widget.ImageView;import android.widget.LinearLayout;import android.widget.TextView;import java.util.ArrayList;import java.util.Collection;import java.util.Collections;import java.util.Comparator;import java.util.List;import butterknife.BindView;import butterknife.ButterKnife;import butterknife.OnClick;import cn.uicai.fulicenter.I;import cn.uicai.fulicenter.R;import cn.uicai.fulicenter.bean.NewGoodsBean;import cn.uicai.fulicenter.utils.ImageLoader;import cn.uicai.fulicenter.utils.MFGT;import cn.uicai.fulicenter.view.FooterViewHolder;/** * Created by xiaomiao on 2016/10/17. */public class GoodsAdapter extends Adapter {    Context mContext;    List<NewGoodsBean> mlist;    boolean isMore;    int soryBy=I.SORT_BY_ADDTIME_DESC;    public boolean isMore() {        return isMore;    }    public void setMore(boolean more) {        isMore = more;        notifyDataSetChanged();//通知页面进行刷新    }    public void setSoryBy(int soryBy) {        this.soryBy = soryBy;        sortBy();        notifyDataSetChanged();    }    public GoodsAdapter(Context Context, List<NewGoodsBean> list) {        this.mContext = Context;        this.mlist = new ArrayList<>();        mlist.addAll(list);    }    /**     * 绑定布局文件     *     * @param parent     * @param viewType     * @return     */    @Override    public ViewHolder onCreateViewHolder(ViewGroup parent, int viewType) {        ViewHolder holder = null;        if (viewType == I.TYPE_FOOTER) {            holder = new FooterViewHolder(View.inflate(mContext, R.layout.item_footer, null));        } else {            holder = new GoodsViewHolder(View.inflate(mContext, R.layout.item_goods, null));        }        return holder;    }    /**     * 绑定数据     *     * @param holder     * @param position     */    @Override    public void onBindViewHolder(ViewHolder holder, int position) {        if (getItemViewType(position) == I.TYPE_FOOTER) {            FooterViewHolder vh = (FooterViewHolder) holder;            vh.mtvFooter.setText(getFootString());        } else {            GoodsViewHolder gh = (GoodsViewHolder) holder;            NewGoodsBean goods = mlist.get(position);            ImageLoader.downloadImg(mContext,gh.mivGoodsThumb,goods.getGoodsThumb());            gh.mtvGoodsname.setText(goods.getGoodsName());            gh.mtvGoodsPrice.setText(goods.getCurrencyPrice());            gh.mlayoutGoods.setTag(goods.getGoodsId());//用setTag获得商品的ID        }    }    /**     * 获取要显示Adapter的总量     *     * @return     */    @Override    public int getItemCount() {        return mlist != null ? mlist.size() + 1 : 1;    }    /**     * 判断返回布局的类型     * @param position     * @return     */    @Override    public int getItemViewType(int position) {        if (position == getItemCount() - 1) {            return I.TYPE_FOOTER;        }        return I.TYPE_ITEM;    }    public void initData(ArrayList<NewGoodsBean> list) {        if (mlist != null) {            mlist.clear();//清空数据        }        mlist.addAll(list);        notifyDataSetChanged();//刷新    }    /**     * 设置是否显示上拉加载     * @return     */    public int getFootString() {        return isMore ? R.string.load_more:R.string.no_more;    }    public void addData(ArrayList<NewGoodsBean> list) {        mlist.addAll(list);        notifyDataSetChanged();    }    class GoodsViewHolder extends ViewHolder{        @BindView(R.id.ivGoodsThumb)        ImageView mivGoodsThumb;        @BindView(R.id.tvGoodsname)        TextView mtvGoodsname;        @BindView(R.id.tvGoodsPrice)        TextView mtvGoodsPrice;        @BindView(R.id.layout_goods)        LinearLayout mlayoutGoods;        GoodsViewHolder(View view) {            super(view);            ButterKnife.bind(this, view);        }        @OnClick(R.id.layout_goods)        public void onGoodsItemClick() {            int goodId = (int) mlayoutGoods.getTag();            MFGT.gotoGoodsDetailActivity(mContext,goodId);        }    }    /**     * 排序     */    private void sortBy() {        Collections.sort(mlist, new Comparator<NewGoodsBean>() {            @Override            public int compare(NewGoodsBean left, NewGoodsBean right) {                int result=0;                switch (soryBy) {                    case I.SORT_BY_ADDTIME_ASC:                     result= (int) (Long.valueOf(left.getAddTime())-Long.valueOf(right.getAddTime()));                        break;                    case I.SORT_BY_ADDTIME_DESC:                        result= (int) (Long.valueOf(right.getAddTime())-Long.valueOf(left.getAddTime()));                        break;                    case I.SORT_BY_PRICE_ASC:                        result = getPrice(left.getCurrencyPrice()) - getPrice(right.getCurrencyPrice());                        break;                    case I.SORT_BY_PRICE_DESC:                        result = getPrice(right.getCurrencyPrice()) - getPrice(left.getCurrencyPrice());                        break;                }                return result;            }            private int getPrice(String price) {                price = price.substring(price.indexOf("￥")+1);                return Integer.valueOf(price);            }        });    }}